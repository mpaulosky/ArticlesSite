@page "/categories/details/{id}"

@inject NavigationManager Navigation
@inject GetCategory.IGetCategoryHandler GetHandler
@inject ILogger<Details> Logger

@attribute [Authorize]


<ComponentHeadingComponent HeaderText="Category Details" Level="1" />

@if (_isLoading)
{
	<LoadingComponent />
}
else if (_category is null)
{
	<ErrorAlertComponent Title="Unable to load category">
		@(_errorMessage ?? "Category not found.")
	</ErrorAlertComponent>
}
else
{
	<div class="container-card bg-gray-700 rounded-lg shadow-lg p-8 max-w-2xl mx-auto mt-6">
		<div class="flex flex-col gap-2">
			<h2 class="text-2xl font-bold text-blue-300 mb-2">@_category.CategoryName</h2>
			<hr class="border-blue-500 mb-4" />
			<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
				<div>
					<span class="font-semibold text-gray-400">Category Slug:</span>
					<span class="text-gray-100">@_category.Slug</span>
				</div>
				<div>
					<span class="font-semibold text-gray-400">Category ID:</span>
					<span class="text-gray-100">@_category.Id</span>
				</div>
				<div>
					<span class="font-semibold text-gray-400">Created On:</span>
					<span class="text-gray-100">@_category.CreatedOn.ToString("f")</span>
				</div>
				<div>
					<span class="font-semibold text-gray-400">Modified On:</span>
					<span class="text-gray-100">@(_category.ModifiedOn?.ToString("f") ?? "Never")</span>
				</div>
				<div>
					<span class="font-semibold text-gray-400">Status:</span>
					@if (_category.IsArchived)
					{
						<span class="badge bg-secondary">Archived</span>
					}
					else
					{
						<span class="badge bg-success">Active</span>
					}
				</div>
			</div>
			<div class="mt-6 flex gap-3 justify-end">
				<button class="btn-primary"
					@onclick="GoToEdit" disabled="@_category.IsArchived">Edit</button>
				<button class="btn-secondary"
					@onclick="GoToList">Back to List</button>
			</div>
		</div>
	</div>
}

@code {

	/// <summary>
	/// The unique identifier of the category to display.
	/// </summary>
	[Parameter]
	public required string Id { get; set; } = string.Empty;

	[CascadingParameter] private Task<AuthenticationState>? AuthenticationState { get; set; }

	/// <summary>
	/// The category data to be displayed on the page.
	/// </summary>
	private CategoryDto? _category;

	/// <summary>
	/// Indicates whether the component is currently loading data.
	/// </summary>
	private bool _isLoading = true;

	/// <summary>
	/// Error message returned by the handler when loading fails. Shown in the UI.
	/// </summary>
	private string? _errorMessage;

	/// <summary>
	/// Initializes the component by loading the category data using the GetCategoryHandler.
	/// </summary>
	protected override async Task OnInitializedAsync()
	{
		Logger?.LogInformation("Loading category details for Id: {CategoryId}", Id);
		_isLoading = true;

		try
		{
			var result = await GetHandler.HandleAsync(Id);

			if (result is { Success: true })
			{
				_category = result.Value;
				_errorMessage = null;
				Logger?.LogInformation("Category loaded successfully: {CategoryId}", Id);
			}
			else
			{
				_category = null;
				_errorMessage = result?.Error ?? "Category not found.";
				Logger?.LogWarning("Failed to load category: {CategoryId}. Error: {Error}", Id, _errorMessage);
			}
		}
		finally
		{
			_isLoading = false;
		}
	}

	/// <summary>
	/// Navigates to the edit page for the current category.
	/// </summary>
	private void GoToEdit()
	{
		Navigation.NavigateTo($"/categories/edit/{Id}");
	}

	/// <summary>
	/// Navigates back to the category list page.
	/// </summary>
	private void GoToList()
	{
		Navigation.NavigateTo("/categories");
	}

}
